<!DOCTYPE html>
<html lang="en">
<head>
  <title>Our simple HTTP server</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">
    const parseJSON = (xhr, content) => {
        
        const obj = JSON.parse(xhr.response);
        console.dir(obj);
        
        if (obj.notes) {
            const noteList = obj.notes;
            
            for (let event in noteList) {
                const note = document.createElement('div');
                
                if (noteList.hasOwnProperty(event)) {
                    let name = document.createElement('p');
                    let desc = document.createElement('p');
                    let date = document.createElement('p');
                    
                    name.textContent = "Event: " + noteList[event].name;
                    desc.textContent = noteList[event].desc;
                    date.textContent = "Date: " + noteList[event].date;
                    
                    note.appendChild(name);
                    note.appendChild(desc);
                    note.appendChild(date);
                }
                
                content.appendChild(note);
            }
        }
    };

    const handleResponse = (xhr, parseResponse) => {
        
        const content = document.querySelector('#content');
        content.innerHTML = " ";
        
        if (xhr.status == 204) {
            content.innerHTML = `<b>Updated (No Content)</b>`;
        }
        else if (parseResponse) {
            parseJSON(xhr, content);   
        }
    };

    const getNotes = (e, form) => {
        
        document.querySelector('#top').style.display = 'none';
        
        let url = '/getNotes';
        let method = 'get';
        
        const xhr = new XMLHttpRequest();
        
        xhr.open(method, url);
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr.setRequestHeader('Accept', 'application/json');
        
        xhr.onload = () => handleResponse(xhr, true);
        
        xhr.send();
        
        e.preventDefault();
        return false;
        
    }
    
    const getTopPriorities = (e, form) => {
        
        docu
    }
   //const requestUpdate = (e, form) => {
   //    
   //    let url;
   //    let method;
   //    
   //    if (form.querySelector('#urlField')) {
   //        url = form.querySelector('#urlField').value;
   //    }
   //    else {
   //        url = '/addNote';
   //    }
   //    
   //    if (form.querySelector('#methodSelect')) {
   //        method = form.querySelector('#methodSelect').value;
   //    }
   //    else {
   //        method = 'post';
   //    }
   //    
   //    const xhr = new XMLHttpRequest();
   //    
   //    xhr.open(method, url);
   //    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
   //    xhr.setRequestHeader('Accept', 'application/json');
   //    
   //    if (method == 'get') {
   //        xhr.onload = () => handleResponse(xhr, true);
   //    }
   //    else if (method == 'head') {
   //        xhr.onload = () => handleResponse(xhr, false);
   //    }
   //    else if (method == 'post') {
   //        xhr.onload = () => handleResponse(xhr, true);
   //    }
   //    
   //    const formData = `name=${nameField.value}&desc=${descField.value}&date=${dateField.value}`;
   //    
   //    xhr.send(formData);
   //    
   //    e.preventDefault();
   //    return false;
   //};

    const init = () => {
        const noteForm = document.querySelector('#noteForm');
        const addNote = (e) => requestUpdate(e, noteForm);
        noteForm.addEventListener('submit', addNote);
        
        const getForm = document.querySelector('#getForm');
        const getNotes = (e) => requestUpdate(e, getForm);
        getForm.addEventListener('submit', getNotes);
    };

    window.onload = init;
  </script>
</head>
<body>
  <section id="top">
    <h3>API Project Prototype - Reminder</h3>
    <form id="noteForm" action="/addNote" method="post">
      <label for="name">Event: </label>
      <input id="nameField" type="text" name="name" />
      <label for="desc">Description (optional): </label>
      <input id="descField" type="text" name="desc" />
      <label for="date">Date: </label>
      <input id="dateField" type="date" name="date" />
      <label for="time">Time: </label>
      <input id="timeField" type="number" name="time" min="5" max="100" />
      <input type="submit" value="Add Note" />
    </form>
    <form id="getForm" action="/getNotes" method="get">
      <select id='urlField'>
        <option value='/getNotes'>/getNotes</option>
        <option value='/notReal'>/notReal</option>
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select>
      <input type="submit" value="Get Event List" />
    </form>
  </section>
  <section id="content">
  </section>
</body>
</html>