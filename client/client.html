<!DOCTYPE html>
<html lang="en">
<head>
  <title>Our simple HTTP server</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">
    const parseJSON = (xhr, content) => {
        
        const obj = JSON.parse(xhr.response);
        console.dir(obj);
        
        if (obj.notes) {
            const noteList = obj.notes;
            
            for (let event in noteList) {
                const note = document.createElement('div');
                
                if (noteList.hasOwnProperty(event)) {
                    let name = document.createElement('p');
                    let desc = document.createElement('p');
                    let date = document.createElement('p');
                    
                    name.textContent = "Event: " + noteList[event].name;
                    desc.textContent = noteList[event].desc;
                    date.textContent = "Date: " + noteList[event].date;
                    
                    note.appendChild(name);
                    note.appendChild(desc);
                    note.appendChild(date);
                }
                
                content.appendChild(note);
            }
        }
    };

    const handleResponse = (xhr, parseResponse) => {
        
        const content = document.querySelector('#content');
        content.innerHTML = " ";
        
        if (xhr.status == 204) {
            content.innerHTML = `<b>Updated (No Content)</b>`;
        }
        else if (parseResponse) {
            parseJSON(xhr, content);   
        }
    };

    const addNotes = (e, form) => {
        
        let url = '/addNote';
        let method = 'post';
        
        const xhr = new XMLHttpRequest();
        
        xhr.open(method, url);
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr.setRequestHeader('Accept', 'application/json');
        
        xhr.onload = () => handleResponse(xhr, true);
        
        const formData = `name=${nameField.value}&desc=${descField.value}&date=${dateField.value}`;
        
        xhr.send(formData);
        
        //e.preventDefault();
        return false;
    };
    
    const getNotes = (e, form) => {
        
        document.querySelector('#submission').style.display = 'none';
        document.querySelector('#content').style.display = 'block';
        
        let url = '/getNotes';
        let method = 'get';
        
        const xhr = new XMLHttpRequest();
        
        xhr.open(method, url);
        xhr.setRequestHeader('Accept', 'application/json');
        
        xhr.onload = () => handleResponse(xhr, true);
        
        xhr.send();
        
        //e.preventDefault();
        return false;
        
    };
    
    const getTopPriorities = (e, form) => {
        
        document.querySelector('#submission').style.display = 'none';
        document.querySelector('#content').style.display = 'block';
        
        let url = '/getNotes?important=true&time=30';
        let method = 'get';
        
        const xhr = new XMLHttpRequest();
        
        xhr.open(method, url);
        xhr.setRequestHeader('Accept', 'application/json');
        
        xhr.onload = () => handleResponse(xhr, true);
        
        xhr.send();
        
        //e.preventDefault();
        return false;
    };

    const init = () => {
        
        const submissionForm = document.querySelector('#submission');
        const content = document.querySelector('#content');
        
        const noteForm = document.querySelector('#noteForm');
        const addNote = (e) => addNotes(e, noteForm);
        noteForm.addEventListener('submit', addNote);
        
        document.querySelector('#writeNote').onclick = (e) => {
            submissionForm.style.display = 'block';
            content.style.display = 'none';
        };
        
        document.querySelector('#allNotes').onclick = (e) => getNotes();
        
        document.querySelector('#topPriorities').onclick = (e) => getTopPriorities();
    };

    window.onload = init;
  </script>
</head>
<body>
    <ul id ="navBar">
        <li id="writeNote">
            <a class="active" href="#">Write</a>
        </li>
        <li id="allNotes">
            <a href="#">Review</a>
        </li>
        <li id="topPriorities">
            <a href="#">Top Priorities</a>
        </li>
    </ul>
    
    <section id="submission">
        <h3>API Project</h3>
        
        <form id="noteForm" action="/addNote" method="post">
            <label for="name">Event: </label>
            <input id="nameField" type="text" name="name" />
            <label for="desc">Description (optional): </label>
            <input id="descField" type="text" name="desc" />
            <label for="date">Date: </label>
            <input id="dateField" type="date" name="date" />
            <label for="time">Time: </label>
            <input id="timeField" type="number" name="time" min="5" max="100" />
            <input type="submit" value="Add Note" />
        </form>
    </section>
    
    <section id="content">
    </section>
</body>
</html>